<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/movie_player.css">
    <title>Observar e Absorver - MiraCine</title>
</head>

<body>
    <div id="sabia-widget-container">

    </div>

    <div id="navbar-container"></div>

    <section class="hero-section">
        <div class="hero-overlay"></div>

        <img src="https://images.unsplash.com/photo-1516382799247-87df95d790b7?q=80&w=2074&auto=format&fit=crop"
            alt="Cena do Documentário" class="hero-image">

        <div class="hero-content">
            <div class="hero-breadcrumb">
                <a href="catalog.html">Documentários</a> <i class="fas fa-chevron-right"></i>
                <span>Filosofia</span>
            </div>

            <div class="hero-text">
                <h1 class="hero-title">
                    Observar <span class="highlight">& Absorver</span>
                </h1>
                <p class="hero-subtitle">
                    A Filosofia de Eduardo Marinho • 2016
                </p>
            </div>

            <div class="hero-actions">
                <button class="btn btn-primary pulse-btn" id="playVideoBtn">
                    <i class="fa-solid fa-play"></i> Assistir Agora
                </button>

                <button class="btn btn-secondary" id="playTrailerBtn">
                    <i class="fa-solid fa-play-circle"></i> Assistir Trailer
                </button>

                <div class="action-buttons">
                    <button class="circle-btn" title="Adicionar à Minha Lista" id="addToListBtn">
                        <i class="fa-solid fa-plus"></i>
                    </button>

                    <button class="circle-btn" title="Favoritar" id="toggleFavoriteBtn">
                        <i class="fa-regular fa-heart"></i>
                    </button>

                    <button class="circle-btn" title="Compartilhar" id="shareContentBtn">
                        <i class="fa-solid fa-share-alt"></i>
                    </button>
                </div>
            </div>

            <div class="quality-indicators">
                <span class="quality-tag">
                    <i class="fas fa-check-circle"></i> 100% Acessível
                </span>
                <span class="quality-tag">
                    <i class="fas fa-closed-captioning"></i> Legendas
                </span>
                <span class="quality-tag">
                    <i class="fas fa-language"></i> Português
                </span>
            </div>
        </div>
    </section>

    <main class="main-container">
        <div class="grid-container">

            <div class="left-column">
                <div class="metadata">
                    <span class="metadata-tag">
                        <i class="fas fa-clock"></i> 1h 41min
                    </span>
                    <span class="metadata-tag">
                        <i class="fas fa-film"></i> Documentário
                    </span>
                    <span class="metadata-tag">
                        <i class="fas fa-volume-high"></i> Português
                    </span>
                    <span class="metadata-tag">
                        <i class="fas fa-eye"></i> Classificação Livre
                    </span>
                    <span class="metadata-tag">
                        <i class="fas fa-calendar"></i> 2016
                    </span>
                </div>

                <div class="content-section">
                    <h3 class="section-title">
                        <i class="fas fa-book-open"></i> Sinopse
                    </h3>
                    <p class="section-text">
                        Eduardo Marinho largou uma vida estável em busca de sentido. Morando nas ruas e observando a
                        sociedade de fora para dentro, ele desenvolveu uma filosofia crua e impactante sobre o sistema,
                        a desigualdade e a verdadeira liberdade humana. Um convite para questionar as estruturas que
                        tomamos como certas.
                    </p>
                </div>

                <div class="content-section">
                    <h3 class="section-title">
                        <i class="fas fa-cogs"></i> Detalhes Técnicos
                    </h3>
                    <div class="technical-details">
                        <div class="detail-item">
                            <span class="detail-label">Direção:</span>
                            <span class="detail-value">Carlos Silva</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Roteiro:</span>
                            <span class="detail-value">Ana Costa</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Fotografia:</span>
                            <span class="detail-value">Pedro Santos</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Produção:</span>
                            <span class="detail-value">MiraCine Studios</span>
                        </div>
                    </div>
                </div>

                <div class="opinion-box">
                    <div class="opinion-header">
                        <h3 class="opinion-title">
                            <i class="fa-solid fa-quote-left"></i> Nossa opinião
                        </h3>
                        <div class="opinion-rating">
                            <span class="rating-value">9.0/10</span>
                            <div class="rating-stars">
                                <i class="fa-solid fa-star"></i>
                                <i class="fa-solid fa-star"></i>
                                <i class="fa-solid fa-star"></i>
                                <i class="fa-solid fa-star"></i>
                                <i class="fa-solid fa-star-half-stroke"></i>
                            </div>
                        </div>
                    </div>
                    <p class="opinion-text">
                        "Uma obra visceral que desafia o espectador. Não é apenas um documentário biográfico, mas um
                        espelho social incômodo e necessário. A retórica de Marinho é afiada e visualmente complementada
                        por uma direção que valoriza o caos urbano."
                    </p>
                    <div class="opinion-author">
                        <img src="https://images.unsplash.com/photo-1568602471122-7832951cc4c5?q=80&w=100&auto=format&fit=crop"
                            alt="Crítico">
                        <div>
                            <strong>João Silva</strong>
                            <span>Crítico MiraCine</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-column">
                <div class="rating-card">
                    <div class="rating-header">
                        <span class="rating-value">4.7</span>
                        <div class="rating-stars">
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star-half-stroke"></i>
                        </div>
                    </div>
                    <span class="rating-label">Avaliação MIRA</span>
                    <div class="rating-stats">
                        <div class="stat-item">
                            <span class="stat-label">Usuários</span>
                            <span class="stat-value">8,423</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Críticos</span>
                            <span class="stat-value">94%</span>
                        </div>
                    </div>
                    <button class="btn-rating" id="rateDocumentaryBtn">
                        <i class="fas fa-star"></i> Avaliar
                    </button>
                </div>

                <div class="watch-card">
                    <h3 class="watch-title">
                        <i class="fas fa-play-circle"></i> Onde Assistir
                    </h3>
                    <div class="watch-options">
                        <button class="watch-option active">
                            <i class="fas fa-play"></i>
                            <span>MiraCine</span>
                            <small>Incluso no Premium</small>
                        </button>
                        <button class="watch-option">
                            <i class="fas fa-film"></i>
                            <span>Evento Especial</span>
                            <small>7 de Novembro</small>
                        </button>
                    </div>
                </div>

                <div class="accessibility-card">
                    <h3 class="accessibility-title">
                        <i class="fas fa-universal-access"></i> Recursos de Acessibilidade
                    </h3>
                    <ul class="accessibility-list">
                        <li><i class="fas fa-check-circle"></i> Legendas em Português</li>
                        <li><i class="fas fa-check-circle"></i> Audiodescrição</li>
                        <li><i class="fas fa-check-circle"></i> Intérprete de LIBRAS</li>
                        <li><i class="fas fa-check-circle"></i> Interface de Alto Contraste</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <section class="featured-section">
        <div class="featured-container">
            <div class="featured-image">
                <img src="https://images.unsplash.com/photo-1542909168-82c3e7fdca5c?q=80&w=1760&auto=format&fit=crop"
                    alt="Eduardo Marinho">
                <div class="image-caption">
                    Eduardo Marinho em cena do documentário
                </div>
            </div>

            <div class="featured-content">
                <div class="featured-badge">Destaque</div>
                <h2 class="featured-title">Eduardo Marinho: O Filósofo das Ruas</h2>
                <div class="featured-meta">
                    <span><i class="fas fa-user"></i> Protagonista</span>
                    <span><i class="fas fa-map-marker-alt"></i> São Paulo, Brasil</span>
                </div>
                <div class="featured-divider"></div>
                <p class="featured-text">
                    Artista plástico, filósofo de rua e ativista social. Filho de família classe média alta, Eduardo
                    abriu mão do conforto material para viver a realidade das ruas, criando uma perspectiva única sobre
                    meritocracia, justiça social e felicidade.
                </p>
                <p class="featured-quote">
                    <i class="fas fa-quote-left"></i>
                    "Não me adapto a uma sociedade profundamente doente."
                    <i class="fas fa-quote-right"></i>
                </p>
                <button class="btn btn-secondary" id="viewBiographyBtn">
                    <i class="fas fa-book"></i> Ver Biografia Completa
                </button>
            </div>
        </div>
    </section>

    <section class="carousel-section">
        <div class="carousel-container">
            <div class="carousel-header">
                <h3 class="carousel-title">
                    <i class="fas fa-film"></i> Recomendados para Você
                </h3>
                <div class="carousel-nav">
                    <button class="carousel-btn prev">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                    <button class="carousel-btn next">
                        <i class="fa-solid fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div class="carousel-items">
                <div class="carousel-card">
                    <img src="https://images.unsplash.com/photo-1485846234645-a62644f84728?q=80&w=1000&auto=format&fit=crop"
                        alt="Cidade de Deus">
                    <div class="card-overlay">
                        <span class="card-title">Cidade de Deus</span>
                        <div class="card-meta">
                            <span><i class="fas fa-clock"></i> 2h 10min</span>
                            <span><i class="fas fa-star"></i> 4.8</span>
                        </div>
                    </div>
                    <div class="card-badge">98% Relevância</div>
                    <button class="card-play">
                        <i class="fas fa-play"></i>
                    </button>
                </div>

                <div class="carousel-card">
                    <img src="https://images.unsplash.com/photo-1536440136628-849c177e76a1?q=80&w=1000&auto=format&fit=crop"
                        alt="Central do Brasil">
                    <div class="card-overlay">
                        <span class="card-title">Central do Brasil</span>
                        <div class="card-meta">
                            <span><i class="fas fa-clock"></i> 1h 50min</span>
                            <span><i class="fas fa-star"></i> 4.6</span>
                        </div>
                    </div>
                    <button class="card-play">
                        <i class="fas fa-play"></i>
                    </button>
                </div>

                <div class="carousel-card">
                    <img src="https://images.unsplash.com/photo-1598899134739-24c46f58b8c0?q=80&w=1000&auto=format&fit=crop"
                        alt="O Auto da Compadecida">
                    <div class="card-overlay">
                        <span class="card-title">O Auto da Compadecida</span>
                        <div class="card-meta">
                            <span><i class="fas fa-clock"></i> 1h 45min</span>
                            <span><i class="fas fa-star"></i> 4.9</span>
                        </div>
                    </div>
                    <button class="card-play">
                        <i class="fas fa-play"></i>
                    </button>
                </div>

                <div class="carousel-card">
                    <img src="https://images.unsplash.com/photo-1512070679279-8988d32161be?q=80&w=1000&auto=format&fit=crop"
                        alt="Tropa de Elite">
                    <div class="card-overlay">
                        <span class="card-title">Tropa de Elite</span>
                        <div class="card-meta">
                            <span><i class="fas fa-clock"></i> 2h 00min</span>
                            <span><i class="fas fa-star"></i> 4.7</span>
                        </div>
                    </div>
                    <div class="card-badge">95% Relevância</div>
                    <button class="card-play">
                        <i class="fas fa-play"></i>
                    </button>
                </div>

                <div class="see-more-card" id="viewCatalogBtn">
                    <div class="see-more-content">
                        <i class="fa-solid fa-arrow-right see-more-icon"></i>
                        <span class="see-more-text">Ver Catálogo Completo</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Botão Fixo de Feedback -->
    <button class="feedback-fixed-btn" id="feedbackFixedBtn">
        <i class="fas fa-universal-access"></i>
        <span class="btn-text">Avaliar Acessibilidade</span>
        <span class="feedback-badge" id="feedbackBadge">Novo!</span>
    </button>

    <!-- Modal de Sugestão de Feedback -->
    <div class="feedback-suggestion-modal" id="feedbackSuggestionModal">
        <div class="modal-header">
            <h4><i class="fas fa-universal-access"></i> Ajude a Melhorar</h4>
            <button class="close-modal-btn" id="closeSuggestionModal">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="film-progress-indicator">
            <div class="film-progress-bar" id="filmProgressBar"></div>
        </div>

        <div class="modal-content">
            <p><strong>Você assistiu 75% do filme!</strong></p>
            <p>Gostaríamos da sua opinião sobre as ferramentas de acessibilidade utilizadas.</p>
            <p>Sua avaliação ajuda a melhorar a experiência para todos.</p>
        </div>

        <div class="modal-actions">
            <button class="modal-btn modal-btn-primary" id="evaluateNowBtn">
                <i class="fas fa-star"></i> Avaliar Agora
            </button>
            <button class="modal-btn modal-btn-secondary" id="laterBtn">
                <i class="far fa-clock"></i> Mais Tarde
            </button>
        </div>

        <label class="dont-show-again">
            <input type="checkbox" id="dontShowAgain"> Não mostrar novamente
        </label>
    </div>

    <!-- Modal de Feedback após filme -->
    <div class="post-movie-modal" id="postMovieModal">
        <div class="modal-content">
            <div class="modal-header">
                <h4><i class="fas fa-film"></i> Filme Concluído!</h4>
                <button class="close-modal-btn" id="closePostMovieModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-icon">
                <i class="fas fa-check-circle"></i>
            </div>

            <h2>O que você achou?</h2>

            <p>Você acabou de assistir <strong>"Observar e Absorver"</strong>.</p>

            <div class="modal-actions">
                <button class="modal-btn modal-btn-primary" id="postEvaluateBtn">
                    <i class="fas fa-universal-access"></i> Avaliar Acessibilidade
                </button>
                <button class="modal-btn modal-btn-secondary" id="rateFilmBtn">
                    <i class="fas fa-star"></i> Avaliar Filme
                </button>
                <button class="modal-btn modal-btn-secondary" id="continueBtn">
                    <i class="fas fa-forward"></i> Continuar Assistindo
                </button>
            </div>

            <label class="dont-show-again" style="margin-top: 20px;">
                <input type="checkbox" id="dontShowPostModal"> Não mostrar essa mensagem novamente
            </label>
        </div>
    </div>

    <!-- Modal de Trailer -->
    <div class="modal" id="trailerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Trailer: Observar e Absorver</h3>
                <button class="modal-close" id="closeTrailerBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="video-placeholder">
                    <i class="fas fa-play-circle"></i>
                    <p>Trailer indisponível no momento</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-container"></div>

    <script src="../js/template.js"></script>
    <script>
        // Sistema Completo de Movie Player
        document.addEventListener('DOMContentLoaded', function () {
            initializeMoviePlayer();
            initializeFeedbackSystem();
        });

        // Sistema do Movie Player
        function initializeMoviePlayer() {
            // Estado do documentário
            const documentary = {
                id: 1,
                title: "Observar e Absorver",
                isFavorite: false,
                isInList: false,
                userRating: null
            };

            // Carregar estado do localStorage
            function loadDocumentaryState() {
                const savedState = localStorage.getItem(`doc_${documentary.id}`);
                if (savedState) {
                    const state = JSON.parse(savedState);
                    documentary.isFavorite = state.isFavorite;
                    documentary.isInList = state.isInList;
                    documentary.userRating = state.userRating;

                    updateFavoriteIcon();
                    updateListIcon();
                    updateRatingDisplay();
                }
            }

            // Configurar event listeners
            function setupEventListeners() {
                // Botão de trailer
                document.getElementById('playTrailerBtn')?.addEventListener('click', playTrailer);

                // Botão assistir agora
                document.getElementById('playVideoBtn')?.addEventListener('click', playVideo);

                // Botões de ação
                document.getElementById('toggleFavoriteBtn')?.addEventListener('click', toggleFavorite);
                document.getElementById('addToListBtn')?.addEventListener('click', addToList);
                document.getElementById('shareContentBtn')?.addEventListener('click', shareContent);
                document.getElementById('rateDocumentaryBtn')?.addEventListener('click', rateDocumentary);
                document.getElementById('viewBiographyBtn')?.addEventListener('click', viewBiography);
                document.getElementById('viewCatalogBtn')?.addEventListener('click', () => {
                    window.location.href = 'catalog.html';
                });

                // Fechar trailer
                document.getElementById('closeTrailerBtn')?.addEventListener('click', closeTrailer);

                // Fechar modal com ESC
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        closeTrailer();
                        hideSuggestionModal();
                        closePostMovieModal();
                    }
                });
            }

            // Funções do movie player
            function toggleFavorite() {
                documentary.isFavorite = !documentary.isFavorite;
                updateFavoriteIcon();
                saveDocumentaryState();
                showNotification(
                    documentary.isFavorite ?
                        'Adicionado aos favoritos!' :
                        'Removido dos favoritos.'
                );
            }

            function addToList() {
                documentary.isInList = !documentary.isInList;
                updateListIcon();
                saveDocumentaryState();
                showNotification(
                    documentary.isInList ?
                        'Adicionado à sua lista!' :
                        'Removido da sua lista.'
                );
            }

            function shareContent() {
                if (navigator.share) {
                    navigator.share({
                        title: documentary.title,
                        text: 'Confira este documentário incrível no MiraCine!',
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href)
                        .then(() => showNotification('Link copiado para a área de transferência!'))
                        .catch(() => alert('Não foi possível copiar o link.'));
                }
            }

            function rateDocumentary() {
                const rating = prompt('De 1 a 5, qual sua avaliação para este documentário?');
                if (rating && rating >= 1 && rating <= 5) {
                    documentary.userRating = parseFloat(rating);
                    saveDocumentaryState();
                    updateRatingDisplay();
                    showNotification(`Obrigado! Você avaliou com ${rating} estrelas.`);
                }
            }

            function playTrailer() {
                document.getElementById('trailerModal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }

            function closeTrailer() {
                document.getElementById('trailerModal').style.display = 'none';
                document.body.style.overflow = '';
            }

            function playVideo() {
                alert('Iniciando reprodução do documentário...');
                // Simular início do filme
                startFilmProgress();
            }

            function viewBiography() {
                alert('Abrindo biografia completa de Eduardo Marinho...');
            }

            // Atualizar ícones
            function updateFavoriteIcon() {
                const heartIcon = document.getElementById('toggleFavoriteBtn')?.querySelector('i');
                if (heartIcon) {
                    heartIcon.className = documentary.isFavorite ?
                        'fa-solid fa-heart' :
                        'fa-regular fa-heart';
                }
            }

            function updateListIcon() {
                const listIcon = document.getElementById('addToListBtn')?.querySelector('i');
                if (listIcon) {
                    listIcon.className = documentary.isInList ?
                        'fa-solid fa-check' :
                        'fa-solid fa-plus';
                }
            }

            function updateRatingDisplay() {
                if (documentary.userRating) {
                    const ratingValue = document.querySelector('.rating-value');
                    if (ratingValue) {
                        ratingValue.textContent = documentary.userRating.toFixed(1);
                    }
                }
            }

            function saveDocumentaryState() {
                localStorage.setItem(`doc_${documentary.id}`, JSON.stringify(documentary));
            }

            // Configurar carrossel
            function setupCarousel() {
                const carousel = document.querySelector('.carousel-items');
                const prevBtn = document.querySelector('.carousel-btn.prev');
                const nextBtn = document.querySelector('.carousel-btn.next');

                if (!carousel || !prevBtn || !nextBtn) return;

                const cardWidth = 200 + 25;

                prevBtn.addEventListener('click', () => {
                    carousel.scrollLeft -= cardWidth * 3;
                });

                nextBtn.addEventListener('click', () => {
                    carousel.scrollLeft += cardWidth * 3;
                });

                // Cards clicáveis
                document.querySelectorAll('.carousel-card').forEach(card => {
                    card.addEventListener('click', function () {
                        const title = this.querySelector('.card-title')?.textContent;
                        alert(`Abrindo detalhes de: ${title}`);
                    });
                });

                // Botões de play nos cards
                document.querySelectorAll('.card-play').forEach(btn => {
                    btn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        const card = this.closest('.carousel-card');
                        const title = card.querySelector('.card-title')?.textContent;
                        alert(`Reproduzindo: ${title}`);
                    });
                });
            }

            // Inicializar
            loadDocumentaryState();
            setupEventListeners();
            setupCarousel();
        }

        // Sistema de Feedback Inteligente
        function initializeFeedbackSystem() {
            // Configurações de feedback
            const feedbackSettings = {
                dontShowSuggestion: localStorage.getItem('dontShowFeedbackSuggestion') === 'true',
                dontShowPostModal: localStorage.getItem('dontShowPostModal') === 'true',
                lastShown: localStorage.getItem('feedbackLastShown') || null,
                timesShown: parseInt(localStorage.getItem('feedbackTimesShown')) || 0
            };

            // Elementos
            const fixedBtn = document.getElementById('feedbackFixedBtn');
            const suggestionModal = document.getElementById('feedbackSuggestionModal');
            const postMovieModal = document.getElementById('postMovieModal');
            const progressBar = document.getElementById('filmProgressBar');

            // Configurar eventos
            function setupFeedbackEvents() {
                // Botão fixo
                fixedBtn?.addEventListener('click', function () {
                    if (!suggestionModal.classList.contains('active')) {
                        showSuggestionModal();
                    } else {
                        hideSuggestionModal();
                    }
                });

                // Fechar modal de sugestão
                document.getElementById('closeSuggestionModal')?.addEventListener('click', hideSuggestionModal);
                document.getElementById('laterBtn')?.addEventListener('click', hideSuggestionModal);

                // Avaliar agora
                document.getElementById('evaluateNowBtn')?.addEventListener('click', goToFeedback);
                document.getElementById('postEvaluateBtn')?.addEventListener('click', goToFeedback);

                // Botões do modal pós-filme
                document.getElementById('rateFilmBtn')?.addEventListener('click', () => {
                    const rating = prompt('De 1 a 5, qual sua avaliação para este filme?');
                    if (rating && rating >= 1 && rating <= 5) {
                        showNotification(`Obrigado! Você avaliou com ${rating} estrelas.`);
                        closePostMovieModal();
                    }
                });

                document.getElementById('continueBtn')?.addEventListener('click', closeAndContinue);
                document.getElementById('closePostMovieModalBtn')?.addEventListener('click', closePostMovieModal);

                // Fechar modal ao clicar fora
                document.addEventListener('click', function (event) {
                    if (suggestionModal.classList.contains('active') &&
                        !suggestionModal.contains(event.target) &&
                        !fixedBtn.contains(event.target)) {
                        hideSuggestionModal();
                    }
                });

                // Não mostrar novamente
                const dontShowCheckbox = document.getElementById('dontShowAgain');
                const dontShowPostCheckbox = document.getElementById('dontShowPostModal');

                if (dontShowCheckbox) {
                    dontShowCheckbox.checked = feedbackSettings.dontShowSuggestion;
                    dontShowCheckbox.addEventListener('change', function () {
                        localStorage.setItem('dontShowFeedbackSuggestion', this.checked);
                        feedbackSettings.dontShowSuggestion = this.checked;
                    });
                }

                if (dontShowPostCheckbox) {
                    dontShowPostCheckbox.checked = feedbackSettings.dontShowPostModal;
                    dontShowPostCheckbox.addEventListener('change', function () {
                        localStorage.setItem('dontShowPostModal', this.checked);
                        feedbackSettings.dontShowPostModal = this.checked;
                    });
                }

                // Atualizar badge
                updateFeedbackBadge();
            }

            // Mostrar modal de sugestão
            function showSuggestionModal() {
                if (suggestionModal && !feedbackSettings.dontShowSuggestion && shouldShowFeedback()) {
                    suggestionModal.classList.add('active');

                    // Esconder badge
                    const badge = document.getElementById('feedbackBadge');
                    if (badge) {
                        badge.style.display = 'none';
                    }

                    // Atualizar contagem
                    feedbackSettings.timesShown++;
                    localStorage.setItem('feedbackTimesShown', feedbackSettings.timesShown);
                    localStorage.setItem('feedbackLastShown', new Date().toISOString());
                }
            }

            // Esconder modal de sugestão
            function hideSuggestionModal() {
                suggestionModal?.classList.remove('active');
            }

            // Fechar modal pós-filme
            function closePostMovieModal() {
                postMovieModal?.classList.remove('active');
            }

            // Simular progresso do filme
            function startFilmProgress() {
                if (!progressBar) return;

                let progress = 0;
                const interval = setInterval(() => {
                    progress += 0.1;
                    progressBar.style.width = `${Math.min(progress, 100)}%`;

                    // Mostrar sugestão em 75%
                    if (progress >= 75 && progress < 76) {
                        if (!feedbackSettings.dontShowSuggestion && shouldShowFeedback()) {
                            showSuggestionModal();
                        }
                    }

                    // Mostrar modal pós-filme em 100%
                    if (progress >= 100) {
                        clearInterval(interval);

                        // Mostrar modal pós-filme após 2 segundos
                        setTimeout(() => {
                            if (postMovieModal && !feedbackSettings.dontShowPostModal) {
                                postMovieModal.classList.add('active');
                            }
                        }, 2000);
                    }
                }, 100); // A cada 100ms
            }

            // Verificar se deve mostrar feedback
            function shouldShowFeedback() {
                const settings = feedbackSettings;

                if (settings.dontShowSuggestion && settings.dontShowPostModal) {
                    return false;
                }

                if (settings.timesShown > 10) {
                    return false;
                }

                if (settings.lastShown) {
                    const lastDate = new Date(settings.lastShown);
                    const now = new Date();
                    const hoursDiff = Math.abs(now - lastDate) / 36e5;

                    if (hoursDiff < 4) {
                        return false;
                    }
                }

                return true;
            }

            // Atualizar badge de feedback
            function updateFeedbackBadge() {
                const badge = document.getElementById('feedbackBadge');
                if (!badge) return;

                const lastShown = feedbackSettings.lastShown;
                if (lastShown) {
                    const lastDate = new Date(lastShown);
                    const now = new Date();
                    const hoursDiff = Math.abs(now - lastDate) / 36e5;

                    if (hoursDiff < 24 && feedbackSettings.timesShown > 3) {
                        badge.style.display = 'none';
                    }
                }
            }

            // Ir para página de feedback
            function goToFeedback() {
                const filmData = {
                    id: 1,
                    title: "Observar e Absorver",
                    watchedAt: new Date().toISOString()
                };
                localStorage.setItem('lastWatchedFilm', JSON.stringify(filmData));
                window.location.href = 'feedback.html';
            }

            // Fechar e continuar
            function closeAndContinue() {
                closePostMovieModal();
                window.location.href = 'catalog.html';
            }

            // Inicializar
            setupFeedbackEvents();
        }

        // Função auxiliar para mostrar notificações
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--primary-color);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                gap: 10px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
                box-shadow: 0 10px 25px rgba(255, 81, 0, 0.3);
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);

            // Adicionar estilos se necessário
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
    </script>
</body>

</html>