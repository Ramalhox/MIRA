<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MIRA | Registro</title>
</head>
<body>
    <div class="auth-container">
        <h1>Crie sua Conta</h1>
        <form id="registerForm">
            <label for="regName">Nome:</label>
            <input type="text" id="regName" value="Novo Usuário" required>

            <label for="regEmail">Email:</label>
            <input type="email" id="regEmail" value="novo.teste@mira.com" required>

            <label for="regPassword">Senha:</label>
            <input type="password" id="regPassword" value="123456" required>
            
            <label for="regRole">Tipo de Conta:</label>
            <select id="regRole" required>
                <option value="ESPECTADOR">Espectador</option>
                <option value="PRODUCER">Produtor</option>
            </select>


            <button type="submit">Registrar</button>
        </form>

        <div id="apiResults" class="status-box">
            </div>
    </div>

    <script src="../js/conn.js"></script>
    <script src="../js/app.js"></script>
    
    <script>
        // LIGAÇÃO DO DOM: Habilita/Desabilita o campo CNPJ
        const roleSelect = document.getElementById('regRole');
        const cnpjInput = document.getElementById('regCnpj');
        
        roleSelect.addEventListener('change', function() {
            const isProducer = this.value === 'PRODUCER';
            cnpjInput.disabled = !isProducer;
            if (isProducer) {
                cnpjInput.setAttribute('required', 'required');
            } else {
                cnpjInput.removeAttribute('required');
            }
        });

        // LIGAÇÃO DO DOM: Captura o envio do formulário de registro
        document.getElementById('registerForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const name = document.getElementById('regName').value;
            const role = roleSelect.value;
            const cnpj = role === 'PRODUCER' ? cnpjInput.value : null;

            registerUser(email, password, name, role, cnpj); // Chama a função do app.js
        });
    </script>
</body>
</html>